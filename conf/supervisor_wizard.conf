; Supervisor 配置文件 - Wizard 项目
; 使用说明：
; 1. 修改所有 /path/to/wizard 为实际项目路径
; 2. 修改日志文件路径（确保目录存在且有写权限）
; 3. 根据实际情况修改 user（或注释掉）
; 4. 将配置文件放到 /etc/supervisor/conf.d/ 目录（或 supervisor 配置的 include 目录）
; 5. 执行 supervisorctl reread 重新读取配置
; 6. 执行 supervisorctl update 更新配置
; 7. 执行 supervisorctl start wizard 启动程序

[program:wizard]
; 程序名称，可以通过 supervisorctl 使用此名称管理程序

; ========== 基本配置 ==========
; 启动命令（使用虚拟环境中的 Python）
command=/path/to/wizard/.venv/bin/python /path/to/wizard/run.py

; 工作目录
directory=/path/to/wizard

; 启动用户（根据实际情况修改或注释）
; user=www-data
; user=nobody

; ========== 自动管理配置 ==========
; 自动启动
autostart=true

; 自动重启
autorestart=true

; 启动重试次数
startretries=3

; 启动等待时间（秒）
startsecs=5

; ========== 停止配置 ==========
; 停止信号
stopsignal=TERM

; 停止等待时间（秒）
stopwaitsecs=10

; 停止整个进程组
stopasgroup=true

; 强制停止时杀死整个进程组
killasgroup=true

; ========== 日志配置 ==========
; 标准输出日志
stdout_logfile=/var/log/wizard/wizard_stdout.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10

; 标准错误日志
stderr_logfile=/var/log/wizard/wizard_stderr.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10

; 或者合并输出和错误到同一个文件（二选一）
; stdout_logfile=/var/log/wizard/wizard.log
; stderr_logfile=/var/log/wizard/wizard.log
; redirect_stderr=true

; ========== 环境变量 ==========
; 设置环境变量
environment=PYTHONUNBUFFERED="1",PYTHONPATH="/path/to/wizard",FLASK_ENV="production"

; ========== 进程配置 ==========
; 进程数量
numprocs=1

; 进程名称模板（当 numprocs > 1 时使用）
process_name=%(program_name)s_%(process_num)02d

; 优先级
priority=999

; ========== 其他配置 ==========
; 退出码（0 和 2 被认为是正常退出）
exitcodes=0,2
